(()=>{class e extends HTMLElement{constructor(){super(),this.templates=["template 1","template 2","template 3"],this.selectedTemplateIndex=2,this.innerHTML='\n      <style>\n        .editor-container {\n          flex: 1;\n          display: flex;\n          flex-direction: column;\n          border-right: 1px solid #ccc;\n          background-color: #333;\n          color: #fff;\n        }\n        .insert-button {\n          background-color: #8bec8b;\n          color: #000;\n          border: none;\n          padding: 10px;\n          margin: 10px;\n          cursor: pointer;\n          font-weight: bold;\n        }\n        .editor-area {\n          flex: 1;\n          padding: 10px;\n          background-color: #333;\n        }\n        .templates-panel {\n          width: 250px;\n          padding: 10px;\n          background-color: #444;\n          color: #fff;\n        }\n        .templates-header {\n          font-size: 18px;\n          margin-bottom: 10px;\n        }\n        .template-list {\n          background-color: #333;\n          margin-bottom: 15px;\n        }\n        .template-item {\n          padding: 5px 10px;\n          cursor: pointer;\n        }\n        .template-item.selected {\n          background-color: #666;\n        }\n        .template-buttons {\n          display: flex;\n          justify-content: flex-end;\n          margin-bottom: 15px;\n        }\n        .template-button {\n          width: 30px;\n          height: 30px;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          margin-left: 5px;\n          cursor: pointer;\n          font-weight: bold;\n        }\n        .remove-template {\n          background-color: red;\n        }\n        .add-template {\n          background-color: #8bec8b;\n        }\n        .edit-template-section {\n          margin-top: 20px;\n        }\n        .edit-template-label {\n          margin-bottom: 10px;\n        }\n        .edit-template-input {\n          width: 100%;\n          padding: 5px;\n          box-sizing: border-box;\n          background-color: #333;\n          color: #fff;\n          border: 1px solid #666;\n        }\n        .tox .template-component {\n          display: inline-block;\n          border: 1px solid #999;\n          border-radius: 3px;\n          background-color: #f0f0f0;\n          padding: 2px 5px;\n          margin: 2px;\n          min-width: 120px;\n        }\n        .template-error {\n          display: inline-block;\n          color: red;\n          font-weight: bold;\n          padding: 2px 5px;\n          margin: 2px;\n          border: 1px solid red;\n          border-radius: 3px;\n          background-color: #fff0f0;\n        }\n        .tox-tinymce {\n          border: none !important;\n          border-radius: 0 !important;\n        }\n        .tox:not(.tox-tinymce-inline) .tox-editor-header {\n          display: none !important;\n        }\n      </style>\n      <div class="editor-container">\n        <button class="insert-button" id="insert-button">Insert</button>\n        <div class="editor-area">\n          <div id="editor-content"></div>\n        </div>\n      </div>\n      <div class="templates-panel">\n        <div class="templates-header">Templates</div>\n        <div class="template-list" id="template-list"></div>\n        <div class="template-buttons">\n          <div class="template-button remove-template" id="remove-template">-</div>\n          <div class="template-button add-template" id="add-template">+</div>\n        </div>\n        <div class="edit-template-section">\n          <div class="edit-template-label">Edit template</div>\n          <input type="text" class="edit-template-input" id="edit-template-input">\n        </div>\n      </div>\n      \n    ',this.templateList=this.querySelector("#template-list"),this.removeTemplateButton=this.querySelector("#remove-template"),this.addTemplateButton=this.querySelector("#add-template"),this.editTemplateInput=this.querySelector("#edit-template-input"),this.insertButton=this.querySelector("#insert-button"),this.renderTemplateList(),this.initEventListeners(),window.addEventListener("load",(()=>{this.initTinyMCE()}))}renderTemplateList(){this.templateList.innerHTML="",this.templates.forEach(((e,t)=>{const n=document.createElement("div");n.className="template-item",t===this.selectedTemplateIndex&&(n.classList.add("selected"),this.editTemplateInput.value=e),n.textContent=e,n.dataset.index=t,this.templateList.appendChild(n)}))}initEventListeners(){this.templateList.addEventListener("click",(e=>{if(e.target.classList.contains("template-item")){const t=parseInt(e.target.dataset.index);this.selectedTemplateIndex=t,this.editTemplateInput.value=this.templates[t],this.renderTemplateList()}})),this.addTemplateButton.addEventListener("click",(()=>{this.templates.push("template"),this.selectedTemplateIndex=this.templates.length-1,this.editTemplateInput.value="template",this.renderTemplateList(),this.editTemplateInput.focus()})),this.removeTemplateButton.addEventListener("click",(()=>{if(this.templates.length>0){const e=this.templates[this.selectedTemplateIndex];this.templates.splice(this.selectedTemplateIndex,1),0===this.templates.length?(this.selectedTemplateIndex=-1,this.editTemplateInput.value=""):(this.selectedTemplateIndex=Math.min(this.selectedTemplateIndex,this.templates.length-1),this.editTemplateInput.value=this.templates[this.selectedTemplateIndex]),this.renderTemplateList(),this.updateDropdownComponents(e)}})),this.editTemplateInput.addEventListener("blur",(()=>{this.updateSelectedTemplate()})),this.editTemplateInput.addEventListener("keydown",(e=>{"Enter"===e.key&&this.updateSelectedTemplate()})),this.insertButton.addEventListener("click",(()=>{this.insertSpecialComponent()}))}updateSelectedTemplate(){if(-1!==this.selectedTemplateIndex){const e=this.templates[this.selectedTemplateIndex],t=this.editTemplateInput.value.trim();""!==t&&t!==e&&(this.templates[this.selectedTemplateIndex]=t,this.renderTemplateList(),this.updateTemplateReferences(e,t))}}initTinyMCE(){"undefined"!=typeof tinymce?(tinymce.PluginManager.add("templatecomponent",(e=>{e.addCommand("insertTemplateComponent",(()=>{this.insertSpecialComponent()})),e.ui.registry.addAutocompleter("templateList",{ch:"@",minChars:0,columns:1,fetch:e=>new Promise((e=>{e(this.templates.map((e=>({value:e,text:e}))))})),onAction:(t,n,i)=>{e.selection.setRng(n);const o=`<span id="${"template-"+Date.now()}" class="template-component" contenteditable="false" data-template="${i}">${i}</span>&nbsp;`;e.insertContent(o),t.hide()}}),e.on("init",(()=>{e.formatter.register("templatecomponent",{inline:"span",classes:"template-component",attributes:{"data-template":"%value"}})})),e.ui.registry.addContextMenu("templatecontextmenu",{update:e=>e.classList.contains("template-component")?"edittemplate removetemplate":""}),e.ui.registry.addMenuItem("edittemplate",{text:"Редактировать шаблон",icon:"edit-block",onAction:()=>{const t=e.selection.getNode();t&&t.classList.contains("template-component")&&this.showTemplateEditor(t)}}),e.ui.registry.addMenuItem("removetemplate",{text:"Удалить шаблон",icon:"remove",onAction:()=>{const t=e.selection.getNode();t&&t.classList.contains("template-component")&&e.dom.remove(t)}})})),tinymce.init({selector:"#editor-content",height:400,menubar:!1,statusbar:!1,plugins:["templatecomponent"],toolbar:"",contextmenu:"templatecontextmenu link table",content_css:!1,content_style:"\n        body { \n          font-family: Arial, sans-serif; \n          padding: 10px; \n          background-color: #333;\n          color: #fff;\n        }\n        .mce-content-body {\n          background-color: #333 !important;\n        }\n        .mce-content-body, .mce-content-body * {\n          border: none !important;\n          border-radius: 0 !important;\n        }\n        .tox-tinymce {\n          border: none !important;\n          border-radius: 0 !important;\n        }\n        .tox:not(.tox-tinymce-inline) .tox-editor-header {\n          display: none !important;\n        }\n        .template-component {\n          display: inline-block;\n          border: none;\n          border-radius: 3px;\n          background-color: gray;\n          padding: 2px 5px;\n          margin: 2px;\n          cursor: pointer;\n          min-width: 100px;\n          position: relative;\n        }\n        .template-error {\n          display: inline-block;\n          color: red;\n          font-weight: bold;\n          padding: 2px 5px;\n          margin: 2px;\n          border: 1px solid red;\n          border-radius: 3px;\n          background-color: #fff0f0;\n        }\n        .template-dropdown {\n          position: absolute;\n          top: 100%;\n          left: 0;\n          z-index: 1000;\n          background-color: gray;\n          border: 1px solid #ccc;\n          border-radius: 3px;\n          box-shadow: 0 2px 5px rgba(0,0,0,0.2);\n          min-width: 100%;\n          display: none;\n        }\n        .template-dropdown.visible {\n          display: block;\n        }\n        .template-dropdown-item {\n          padding: 5px 10px;\n          cursor: pointer;\n        }\n        .template-dropdown-item:hover {\n          background-color: #f0f0f0;\n        }\n      ",setup:e=>{this.editor=e,e.on("click",(e=>{const t=e.target;t.classList.contains("template-component")?(this.showTemplateSelector(t),e.stopPropagation()):this.closeAllDropdowns()})),e.on("init",(()=>{e.setContent("<p>There is some text that user typed manually</p>"),e.getWin().addEventListener("click",(e=>{e.target.closest(".template-component")||e.target.closest(".template-dropdown")||this.closeAllDropdowns()}))}))}})):console.error("TinyMCE не загружен")}closeAllDropdowns(){this.editor&&this.editor.getDoc().querySelectorAll(".template-dropdown.visible").forEach((e=>{e.classList.remove("visible")}))}showTemplateSelector(e){if(!this.editor)return;this.closeAllDropdowns();let t=e.querySelector(".template-dropdown");t||(t=this.editor.dom.create("div",{class:"template-dropdown"}),this.templates.forEach((n=>{const i=this.editor.dom.create("div",{class:"template-dropdown-item","data-value":n},n);this.editor.dom.bind(i,"click",(i=>{e.setAttribute("data-template",n),e.textContent=n,t.classList.remove("visible"),i.stopPropagation()})),t.appendChild(i)})),e.appendChild(t)),t.classList.add("visible")}showTemplateEditor(e){const t=e.getAttribute("data-template"),n=this.templates.indexOf(t);-1!==n&&(this.selectedTemplateIndex=n,this.editTemplateInput.value=t,this.renderTemplateList(),this.editTemplateInput.scrollIntoView(),this.editTemplateInput.focus())}insertSpecialComponent(){if(!this.editor||0===this.templates.length)return;const e=this.templates[this.selectedTemplateIndex]||this.templates[0],t=`<span id="${"template-"+Date.now()}" class="template-component" contenteditable="false" data-template="${e}">${e}</span>&nbsp;`;this.editor.insertContent(t)}updateDropdownComponents(e){this.editor&&this.editor.dom.select('.template-component[data-template="'+e+'"]').forEach((e=>{const t=this.editor.dom.create("span",{class:"template-error"},"ERROR");this.editor.dom.replace(t,e)}))}updateTemplateReferences(e,t){this.editor&&this.editor.dom.select('.template-component[data-template="'+e+'"]').forEach((e=>{e.setAttribute("data-template",t),e.textContent=t}))}}customElements.get("editor-app")||customElements.define("editor-app",e)})();